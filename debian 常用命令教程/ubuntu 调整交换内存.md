### 方法一：使用 `swapfile`（推荐给现代桌面用户）

这是最简单、最安全且最灵活的方法，无需重新分区。Ubuntu 自 17.04 版本以后，默认就使用 `swapfile` 而不是专用的 `swap` 分区。

**步骤：**

1.  **查看当前交换空间状态**
    在开始之前，先检查一下现有的交换空间情况。
    ```bash
    sudo swapon --show
    free -h
    ```
    这会显示当前激活的交换文件（或分区）的大小和使用情况。

2.  **关闭现有的交换文件**
    （如果 `swapon --show` 没有任何输出，说明当前没有启用交换空间，可以跳过这一步。）
    ```bash
    sudo swapoff -v /swap.img
    ```
    注意：**请确保你有足够的内存来执行这个操作**。如果物理内存不足，系统可能会变卡甚至崩溃。最好在关闭所有大型程序后操作。这个命令可能需要一些时间，因为系统需要将数据从交换文件移回内存。

    *   传统的交换文件可能是 `/swapfile` 或像上面的 `/swap.img`。请使用 `swapon --show` 命令显示的实际路径。

3.  **删除旧交换文件**（可选）
    如果你想完全重新开始，或者旧文件大小不对，可以删除它。
    ```bash
    sudo rm /swap.img
    ```
    *同样，请确保路径正确。*

4.  **创建新的交换文件**
    现在创建你想要大小的新交换文件。例如，我们要创建一个 8GB 的文件：
    ```bash
    sudo dd if=/dev/zero of=/swap.img bs=1M count=8192 status=progress
    ```
    *   `bs=1M`：每次写入 1 MiB 的数据块。
    *   `count=8192`：写入 8192 个块。1M * 8192 = 8 GiB。
    *   `of=/swap.img`：输出文件路径和名称。你可以使用 `/swapfile` 或任何你喜欢的名字，但通常放在根目录下。
    *   `status=progress`：显示创建进度。

    **更快的现代方法（推荐）：**
    ```bash
    sudo fallocate -l 8G /swap.img
    ```
    `fallocate` 命令比 `dd` 快得多，但某些旧文件系统（如 EXT3）可能不支持。对于 EXT4 或 BtrFS，它是首选。

5.  **设置正确的权限**
    交换文件不能能被其他用户读写，出于安全原因，必须设置严格的权限。
    ```bash
    sudo chmod 600 /swap.img
    ```

6.  **格式化文件为交换空间**
    使用 `mkswap` 命令将这个文件格式化为交换格式。
    ```bash
    sudo mkswap /swap.img
    ```

7.  **启用新的交换文件**
    ```bash
    sudo swapon /swap.img
    ```

8.  **验证新交换空间**
    再次运行命令检查是否成功启用以及新大小是否正确。
    ```bash
    sudo swapon --show
    free -h
    ```

9.  **永久化设置（关键步骤）**
    上面的设置重启后会失效。要让它永久生效，需要编辑 `/etc/fstab` 文件。
    ```bash
    sudo nano /etc/fstab
    ```
    在文件末尾添加一行（如果已有交换文件项，请修改或注释掉旧的那行）：
    ```
    /swap.img none swap sw 0 0
    ```
    *   保存并退出（在 nano 中按 `Ctrl+X`，然后 `Y`，最后回车）。

**完成后，你的新交换空间就已经设置好并且会在每次启动时自动挂载了。**

---

### 方法二：调整 `swap` 分区大小（不推荐，更复杂）

这种方法涉及调整磁盘分区，**有数据丢失的巨大风险**，操作前**必须备份所有重要数据**。通常只在安装系统时分配交换分区大小出错时才考虑此方法。

基本步骤需要启动到 Live USB 环境，使用 `GParted` 这类图形化分区工具来收缩主分区，然后扩大交换分区。由于过程复杂且危险，除非你非常清楚自己在做什么，否则**强烈建议使用上面的 `swapfile` 方法**。

---

### 应该设置多大的交换空间？

这是一个经典问题，没有唯一答案，但可以参考以下经验法则：

1.  **桌面系统**：
    *   **传统建议**：物理内存的 1.5 到 2 倍。
    *   **现代建议**：对于拥有足够内存（如 8GB+）的现代桌面系统，交换空间主要用于休眠（Hibernation）和应对极端内存压力。
        *   **如果启用休眠**：交换空间大小**至少**需要等于你的物理内存大小（RAM）。为了保险起见，通常建议是 `物理内存大小 + 10%`。
        *   **如果不休眠**：4GB 到 8GB 通常绰绰有余。甚至对于拥有大量内存（如 16GB+）的系统，可以设置一个较小的交换空间（如 2GB-4GB）或者完全不用（但完全不推荐，有些程序会需要）。

2.  **服务器系统**：
    *   **工作负载已知**：根据应用程序的内存需求来定。
    *   **通用建议**：通常等于物理内存大小，或者至少 4GB。对于内存非常大的服务器（如 64GB+），可以设置较小的交换空间（如 4GB-8GB），其主要目的是让内核在内存压力极大时有机会终止失控的进程，而不是真正用来做大量数据交换。

### 调整 `swappiness`（可选）

`swappiness` 是一个内核参数，控制系统有多“积极”地使用交换空间。值从 0 到 100：
*   **0**：尽可能避免使用交换空间。
*   **100**：积极使用交换空间。

Ubuntu 桌面版默认值通常是 `60`。对于拥有足够内存的现代系统，可以适当降低这个值（例如设为 `10`），让系统更倾向于使用物理内存，从而可能提升响应速度。

*   **查看当前值**：
    ```bash
    cat /proc/sys/vm/swappiness
    ```

*   **临时更改**（重启后失效）：
    ```bash
    sudo sysctl vm.swappiness=10
    ```

*   **永久更改**：
    ```bash
    sudo nano /etc/sysctl.conf
    ```
    在文件末尾添加：
    ```
    vm.swappiness=10
    ```
    保存退出，重启后生效。

### 总结

对于绝大多数 Ubuntu 桌面用户，**使用方法一（操作 `swapfile`）是调整交换空间大小最安全、最简单的方式**。你无需触碰磁盘分区，只需要创建、格式化并启用一个文件即可。记得根据你的内存大小和是否使用休眠功能来决定最终的大小。
